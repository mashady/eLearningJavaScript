<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./styles/home/home.css" />
    <title>ðŸ˜‚ðŸ˜‚ðŸ˜‚ðŸ˜‚ðŸ˜‚ðŸ˜‚ðŸ˜‚</title>
    <style>
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
      }

      .modal-overlay.active {
        display: flex;
      }

      .modal {
        background: white;
        padding: 20px;
        border-radius: 10px;
        width: 700px;
        max-width: 90%;
        position: relative;
      }

      .close-modal {
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
      }

      .form-step {
        display: none;
      }

      .form-step.active {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(50px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes slideOut {
        from {
          opacity: 1;
          transform: translateX(0);
        }
        to {
          opacity: 0;
          transform: translateX(-50px);
        }
      }

      .form-step.active {
        animation: slideIn 0.3s ease-in-out;
      }

      .form-step {
        animation: slideOut 0.3s ease-in-out;
      }
      input,
      textarea {
        display: block;
        margin-bottom: 20px;
        border: 0.1rem solid gray;
        color: var(--black);
        background-color: transparent;
        border-radius: 10px;
        padding: 1rem;
        outline: none;
        font-size: 18px;
        width: 80%;
      }
      button {
        margin-top: 40px;
        margin-bottom: 30px;
        border: 1px solid #fff;
        padding: 1rem;
        background-color: var(--yellow);
        border-radius: 10px;
        cursor: pointer;
        text-transform: capitalize;
        font-size: 20px;
        max-width: 80%;
      }
      #lessonFormContainer {
        width: 100%;
        justify-content: center;
        align-items: center;
        display: flex;
        flex-direction: column;
      }
      .edit-section {
        margin: 20px;
        display: flex;
        gap: 10px;
        align-items: center;
      }

      #courseSelect {
        padding: 8px;
        border-radius: 5px;
        min-width: 200px;
      }
    </style>
  </head>
  <body>
    <div class="edit-section">
      <select id="courseSelect"></select>
      <button id="editCourse">Edit Course</button>
    </div>

    <button id="openModal" style="margin-left: 20px">Add Course</button>

    <div id="modalOverlay" class="modal-overlay">
      <div class="modal">
        <span id="closeModal" class="close-modal">&times;</span>

        <form id="multiStepForm">
          <div id="step1" class="form-step active">
            <h2>Step 1: General Information</h2>
            <input
              type="text"
              id="title"
              name="title"
              required
              placeholder="Enter course title"
            />

            <input
              type="url"
              id="image"
              name="image"
              required
              placeholder="Put course cover"
            />

            <input
              type="text"
              id="category"
              name="category"
              required
              placeholder="category"
            />

            <textarea
              id="description"
              name="description"
              required
              placeholder="Add course description"
            ></textarea>

            <input
              type="number"
              id="price"
              name="price"
              step="0.01"
              placeholder="Enter course price if free leave empty"
              required
            />

            <input
              type="text"
              id="duration"
              name="duration"
              required
              placeholder="Course duration"
            />

            <button type="button" id="nextStep1">Next</button>
          </div>

          <div id="step2" class="form-step">
            <h2>Step 2: Number of Lessons</h2>
            <label for="lessonCount"
              >How many lessons do you want to add?</label
            >
            <input
              type="number"
              id="lessonCount"
              name="lessonCount"
              min="1"
              placeholder="enter lesson number"
              required
            />
            <div style="display: flex; justify-content: space-between">
              <button type="button" id="prevStep2">Previous</button>
              <button type="button" id="nextStep2">Next</button>
            </div>
          </div>

          <div id="lessonSteps" class="form-step">
            <h2>Step <span id="currentLessonNumber"></span>: Add Lesson</h2>
            <div id="lessonFormContainer">
              <input
                type="text"
                id="lessonTitle"
                name="lessonTitle"
                placeholder="enter lesson title"
                required
              />

              <input
                type="text"
                id="lessonDuration"
                name="lessonDuration"
                placeholder="enter lesson duration"
                required
              />

              <input
                type="url"
                id="lessonVideo"
                name="lessonVideo"
                placeholder="enter lesson video url"
                required
              />

              <input
                type="url"
                id="lessonPdf"
                name="lessonPdf"
                placeholder="enter lesson pdf url"
                required
              />
            </div>
            <div style="display: flex; justify-content: space-between">
              <button type="button" id="prevLessonStep">Previous</button>
              <button type="button" id="nextLessonStep">Next</button>
            </div>
          </div>

          <div id="finalStep" class="form-step">
            <h2>Review and Submit</h2>
            <p>
              Please review your course details and lessons before submitting.
            </p>
            <div style="display: flex; justify-content: space-between">
              <button type="button" id="prevFinalStep">Previous</button>
              <button type="submit" id="submitForm">Submit</button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <script>
      let isEditing = false;
      let currentCourseId = null;

      function populateCourseSelect() {
        const courseSelect = document.getElementById("courseSelect");
        courseSelect.innerHTML =
          '<option value="">Select Course to Edit</option>';

        coursesData.courses.forEach((course) => {
          const option = document.createElement("option");
          option.value = course.ID;
          option.textContent = course.Title;
          courseSelect.appendChild(option);
        });
      }

      document.getElementById("editCourse").addEventListener("click", () => {
        const selectedId = document.getElementById("courseSelect").value;
        if (!selectedId) return alert("Please select a course to edit");

        const courseToEdit = coursesData.courses.find(
          (c) => c.ID === selectedId
        );
        if (!courseToEdit) return alert("Course not found");

        isEditing = true;
        currentCourseId = selectedId;
        console.log("selectedId", selectedId);
        loadCourseData(courseToEdit);
        modalOverlay.classList.add("active");
      });

      function loadCourseData(course) {
        document.getElementById("title").value = course.Title;
        document.getElementById("image").value = course.Image;
        document.getElementById("category").value = course.Category;
        document.getElementById("description").value = course.Description;
        document.getElementById("price").value = course.Price;
        document.getElementById("duration").value = course.Duration;

        lessonCountInput.value = course.Content.length;
        lessonCount = course.Content.length;

        lessons.length = 0;
        course.Content.forEach((lesson) => {
          lessons.push({
            lessonTitle: lesson.lesson_title,
            lessonDuration: lesson.lesson_duration,
            lessonVideo: lesson.lesson_video,
            lessonPdf: lesson.lesson_pdf,
          });
        });

        currentLesson = 1;
        updateLessonStep();
        showStep(lessonSteps);
      }

      function resetForm() {
        multiStepForm.reset();
        lessonCount = 0;
        currentLesson = 1;
        lessons.length = 0;
        isEditing = false;
        currentCourseId = null;
        showStep(step1);
      }

      document.addEventListener("DOMContentLoaded", populateCourseSelect);
      let coursesData = JSON.parse(localStorage.getItem("coursesData")) || {
        courses: [],
      };

      const openModalButton = document.getElementById("openModal");
      const closeModalButton = document.getElementById("closeModal");
      const modalOverlay = document.getElementById("modalOverlay");
      const multiStepForm = document.getElementById("multiStepForm");

      const step1 = document.getElementById("step1");
      const step2 = document.getElementById("step2");
      const lessonSteps = document.getElementById("lessonSteps");
      const finalStep = document.getElementById("finalStep");

      const nextStep1Button = document.getElementById("nextStep1");
      const prevStep2Button = document.getElementById("prevStep2");
      const nextStep2Button = document.getElementById("nextStep2");
      const prevLessonStepButton = document.getElementById("prevLessonStep");
      const nextLessonStepButton = document.getElementById("nextLessonStep");
      const prevFinalStepButton = document.getElementById("prevFinalStep");

      const lessonCountInput = document.getElementById("lessonCount");
      const currentLessonNumber = document.getElementById(
        "currentLessonNumber"
      );

      const lessonTitleInput = document.getElementById("lessonTitle");
      const lessonDurationInput = document.getElementById("lessonDuration");
      const lessonVideoInput = document.getElementById("lessonVideo");
      const lessonPdfInput = document.getElementById("lessonPdf");

      let lessonCount = 0;
      let currentLesson = 1;
      const lessons = [];

      openModalButton.addEventListener("click", () => {
        modalOverlay.classList.add("active");
        showStep(step1);
      });

      closeModalButton.addEventListener("click", () => {
        modalOverlay.classList.remove("active");
        resetForm();
      });

      nextStep1Button.addEventListener("click", () => showStep(step2));
      prevStep2Button.addEventListener("click", () => showStep(step1));
      nextStep2Button.addEventListener("click", () => {
        lessonCount = parseInt(lessonCountInput.value);
        if (lessonCount > 0) {
          currentLesson = 1;
          updateLessonStep();
          showStep(lessonSteps);
        }
      });
      prevLessonStepButton.addEventListener("click", () => {
        if (currentLesson > 1) {
          currentLesson--;
          updateLessonStep();
        } else {
          showStep(step2);
        }
      });
      nextLessonStepButton.addEventListener("click", () => {
        saveCurrentLesson();
        if (currentLesson < lessonCount) {
          currentLesson++;
          updateLessonStep();
        } else {
          showStep(finalStep);
        }
      });
      prevFinalStepButton.addEventListener("click", () => {
        currentLesson = lessonCount;
        updateLessonStep();
        showStep(lessonSteps);
      });

      function updateLessonStep() {
        currentLessonNumber.textContent = currentLesson;
        const lesson = lessons[currentLesson - 1] || {};
        lessonTitleInput.value = lesson.lessonTitle || "";
        lessonDurationInput.value = lesson.lessonDuration || "";
        lessonVideoInput.value = lesson.lessonVideo || "";
        lessonPdfInput.value = lesson.lessonPdf || "";
      }

      function saveCurrentLesson() {
        const lesson = {
          lessonTitle: lessonTitleInput.value,
          lessonDuration: lessonDurationInput.value,
          lessonVideo: lessonVideoInput.value,
          lessonPdf: lessonPdfInput.value,
        };
        lessons[currentLesson - 1] = lesson;
      }
      /*
      multiStepForm.addEventListener("submit", function (event) {
        event.preventDefault();

        const title = document.getElementById("title").value;
        const image = document.getElementById("image").value;
        const category = document.getElementById("category").value;
        const description = document.getElementById("description").value;
        const price = parseFloat(document.getElementById("price").value);
        const duration = document.getElementById("duration").value;

        const id = (coursesData.courses.length + 1).toString();

        const newCourse = {
          ID: isEditing ? currentCourseId : id,
          Title: title,
          Image: image,
          Category: category,
          Description: description,
          Price: price,
          Duration: duration,
          Content: lessons.map((lesson, index) => ({
            lesson_id: index + 1,
            lesson_title: lesson.lessonTitle,
            lesson_duration: lesson.lessonDuration,
            lesson_video: lesson.lessonVideo,
            lesson_pdf: lesson.lessonPdf,
          })),
        };

        coursesData.courses.push(newCourse);

        localStorage.setItem("coursesData", JSON.stringify(coursesData));

        console.log("Updated Courses Data:", coursesData);

        modalOverlay.classList.remove("active");
        resetForm();

        alert("Course added successfully!");
        if (isEditing) {
          isEditing = false;
        }
      });
*/
      multiStepForm.addEventListener("submit", function (event) {
        event.preventDefault();

        const title = document.getElementById("title").value;
        const image = document.getElementById("image").value;
        const category = document.getElementById("category").value;
        const description = document.getElementById("description").value;
        const price = parseFloat(document.getElementById("price").value);
        const duration = document.getElementById("duration").value;

        const newCourse = {
          ID: isEditing
            ? currentCourseId
            : (coursesData.courses.length + 1).toString(),
          Title: title,
          Image: image,
          Category: category,
          Description: description,
          Price: price,
          Duration: duration,
          Content: lessons.map((lesson, index) => ({
            lesson_id: index + 1,
            lesson_title: lesson.lessonTitle,
            lesson_duration: lesson.lessonDuration,
            lesson_video: lesson.lessonVideo,
            lesson_pdf: lesson.lessonPdf,
          })),
        };

        if (isEditing) {
          const courseIndex = coursesData.courses.findIndex(
            (course) => course.ID === currentCourseId
          );

          if (courseIndex !== -1) {
            coursesData.courses[courseIndex] = newCourse;
          } else {
            alert("Course not found, adding as new");
            coursesData.courses.push(newCourse);
          }
        } else {
          coursesData.courses.push(newCourse);
        }

        localStorage.setItem("coursesData", JSON.stringify(coursesData));
        console.log("Updated Courses Data:", coursesData);

        modalOverlay.classList.remove("active");
        resetForm();
        populateCourseSelect();
        alert(
          isEditing
            ? "Course updated successfully!"
            : "Course added successfully!"
        );

        isEditing = false;
        currentCourseId = null;
      });
      function resetForm() {
        multiStepForm.reset();
        lessonCount = 0;
        currentLesson = 1;
        lessons.length = 0;
        showStep(step1);
      }

      function showStep(step) {
        document
          .querySelectorAll(".form-step")
          .forEach((s) => s.classList.remove("active"));
        step.classList.add("active");
      }
    </script>
  </body>
</html>
